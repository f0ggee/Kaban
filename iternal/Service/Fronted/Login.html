<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Filesb — Sign in</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#070a09; --panel:#000; --text:#e6fff5; --muted:#7fe3b6; --border:#114436;
      --primary:#18b77a; --primary-press:#0ea36a; --focus:#2dd4a7;
    }

    *,*::before,*::after{ box-sizing:border-box }

    html,body{
      height:100%; margin:0; background:var(--bg); color:var(--text);
      font-family:"Inter", system-ui, sans-serif;
    }

    .container{
      max-width:460px; margin:0 auto; padding:clamp(20px, 8vh, 64px) 16px;
    }

    .brand{
      text-align:center; margin-bottom:32px; font-weight:700;
      color:var(--primary); font-size:clamp(22px, 5vw, 26px);
    }

    .brand small{
      display:block; margin-top:10px; font-size:clamp(14px, 4vw, 16px);
      font-weight:400; color:var(--muted); opacity:.9;
    }

    .card{
      background:var(--panel); border:1px solid var(--border);
      border-radius:22px; padding:clamp(20px, 6vw, 36px) clamp(16px, 5vw, 28px);
      box-shadow:0 0 40px rgba(24,183,122,.15);
    }

    h1{
      text-align:center; color:var(--primary);
      font-size:clamp(26px, 7vw, 36px); margin:0 0 14px;
    }

    .sub{
      text-align:center; color:var(--muted);
      font-size:clamp(15px, 4vw, 18px); margin-bottom:32px;
    }

    .field{ margin-bottom:22px; }

    label{
      display:block; font-size:clamp(15px, 4vw, 17px);
      margin-bottom:8px; color:var(--text); font-weight:500;
    }

    .input-wrap{ position:relative; }

    .input{
      width:100%; padding:clamp(14px, 3.5vw, 18px);
      padding-right:80px; font-size:16px; border-radius:14px;
      border:1px solid var(--border); background:#0a1612;
      color:var(--text); outline:none; transition: all 0.2s;
    }

    .input:focus{
      border-color:var(--focus); box-shadow:0 0 0 3px rgba(45,212,167,.12);
    }

    .toggle{
      position:absolute; right:12px; top:50%; transform:translateY(-50%);
      background:none; border:0; color:var(--muted);
      font-size:14px; cursor:pointer; font-weight:600; padding:5px;
    }

    .forgot{ text-align:right; margin-top:8px; margin-bottom:24px; }
    .forgot a{ color:var(--muted); text-decoration:none; font-size:15px; }
    .forgot a:hover{ color:var(--text) }

    .btn-primary{
      width:100%; padding:clamp(16px, 4vw, 20px);
      font-size:clamp(18px, 5vw, 20px); font-weight:700;
      border-radius:16px; border:none; background:var(--primary);
      color:#002116; cursor:pointer; transition: 0.2s;
    }

    .btn-primary:hover{ background:var(--primary-press); transform: translateY(-1px); }
    .btn-primary:disabled{ opacity:.5; cursor:not-allowed; }

    .create{ margin-top:24px; text-align:center; }
    .create button{
      background:#fff; color:#000; border:none; border-radius:12px;
      padding:10px 20px; font-size:16px; cursor:pointer; font-weight:600;
      transition: 0.2s;
    }
    .create button:hover { opacity: 0.9; }

    .message{
      margin-top:18px; padding:12px; border-radius:12px;
      text-align:center; font-weight:600; display:none; font-size:14px;
    }
    .message.error{ background:#2b0d0d; color:#ffb4b4; display:block; border: 1px solid #5c1a1a; }

    .footer{
      margin-top:34px; text-align:center; font-size:14px;
      color:var(--muted); opacity:0.6;
    }

    @media (max-width: 380px) {
      .card { border-radius: 16px; padding: 20px 14px; }
      .input { padding: 12px; }
    }
  </style>
</head>
<body>

<div class="container">
  <div class="brand">
    Filesb
    <small data-i18n="brandSub">Fast file sharing without extra steps</small>
  </div>

  <div class="card">
    <h1 data-i18n="h1">Sign in</h1>
    <p class="sub" data-i18n="sub">Continue to access your personal files</p>

    <form id="loginForm" action="/login/api" method="post" novalidate>
      <div class="field">
        <label data-i18n="emailLabel">Email</label>
        <input id="email" class="input" type="email" placeholder="name@example.com" required>
      </div>

      <div class="field">
        <label data-i18n="passLabel">Password</label>
        <div class="input-wrap">
          <input id="password" class="input" type="password" required>
          <button type="button" class="toggle" id="togglePwd" data-i18n="show">Show</button>
        </div>
      </div>

      <div class="forgot">
        <a href="/forgot" data-i18n="forgot">Forgot password?</a>
      </div>

      <button id="submitBtn" type="submit" class="btn-primary" data-i18n="h1">Sign in</button>
      <div id="responseMessage" class="message"></div>
    </form>

    <div class="create">
      <button id="registerBtn" type="button" data-i18n="create">Create account</button>
    </div>

    <div class="footer">© 2026 Filesb</div>
  </div>
</div>

<script>
  // 1. Словарь текстов интерфейса
  const uiTranslations = {
    en: {
      brandSub: "Fast file sharing without extra steps",
      h1: "Sign in",
      sub: "Continue to access your personal files",
      emailLabel: "Email",
      passLabel: "Password",
      show: "Show",
      hide: "Hide",
      create: "Create account",
      passPlaceholder: "Enter your password",
      btnLoading: "Signing in...",
      btnReady: "Sign in",
      defaultError: "Connection error"
    },
    ru: {
      brandSub: "Быстрый обмен файлами без лишних шагов",
      h1: "Вход",
      sub: "Войдите, чтобы получить доступ к своим файлам",
      emailLabel: "Эл. почта",
      passLabel: "Пароль",
      show: "Показать",
      hide: "Скрыть",
      create: "Создать аккаунт",
      passPlaceholder: "Введите пароль",
      btnLoading: "Вход...",
      btnReady: "Вход",
      defaultError: "Ошибка подключения"
    }
  };

  // 2. Словарь перевода ОШИБОК БЭКЕНДА
  const backendErrors = {
    "Data is invalid": {
      en: "Invalid email or password",
      ru: "Неверная почта или пароль"
    },
    "Something went wrong": {
      en: "Server error. Please try again later",
      ru: "Ошибка сервера. Попробуйте позже"
    }
  };

  const currentLang = localStorage.getItem('userLanguage') || 'en';

  function applyLanguage() {
    document.querySelectorAll('[data-i18n]').forEach(el => {
      const key = el.getAttribute('data-i18n');
      if (uiTranslations[currentLang][key]) el.textContent = uiTranslations[currentLang][key];
    });
    document.getElementById('password').placeholder = uiTranslations[currentLang].passPlaceholder;
  }

  function getTranslatedError(serverMsg) {
    if (backendErrors[serverMsg] && backendErrors[serverMsg][currentLang]) {
      return backendErrors[serverMsg][currentLang];
    }
    return serverMsg || uiTranslations[currentLang].defaultError;
  }

  const form = document.getElementById('loginForm');
  const submitBtn = document.getElementById('submitBtn');
  const responseDiv = document.getElementById('responseMessage');
  const pwdInput = document.getElementById('password');
  const togglePwd = document.getElementById('togglePwd');
  const emailInput = document.getElementById('email');
  const registerBtn = document.getElementById('registerBtn');

  togglePwd.onclick = () => {
    const isPwd = pwdInput.type === 'password';
    pwdInput.type = isPwd ? 'text' : 'password';
    togglePwd.textContent = isPwd ? uiTranslations[currentLang].hide : uiTranslations[currentLang].show;
  };

  registerBtn.onclick = () => window.location.href = '/register';

  form.onsubmit = async (e) => {
    e.preventDefault();
    responseDiv.style.display = 'none';
    responseDiv.className = 'message';
    submitBtn.disabled = true;
    const originalBtnText = submitBtn.textContent;
    submitBtn.textContent = uiTranslations[currentLang].btnLoading;

    try {
      const res = await fetch(form.action, {
        method:'POST',
        headers:{ 'Content-Type':'application/json' },
        body:JSON.stringify({ email: emailInput.value.trim(), password: pwdInput.value })
      });

      let data;
      try { data = await res.json(); } catch (e) { data = null; }

      // 1. УСПЕХ (200)
      if (res.status === 200) {
        if (data && data.UrlToRedict) {
          window.location.href = data.UrlToRedict;
        } else {
          window.location.href = '/dashboard';
        }
      }
      // 2. ОШИБКА КЛИЕНТА (400)
      else if (res.status === 400) {
        responseDiv.className = 'message error';
        if (data && data.ErrorMessage) {
          responseDiv.textContent = getTranslatedError(data.ErrorMessage);
        } else {
          responseDiv.textContent = getTranslatedError("Data is invalid");
        }
        responseDiv.style.display = 'block';
      }
      // 3. ОШИБКА СЕРВЕРА (500 и прочие)
      else {
        responseDiv.className = 'message error';
        const msg = (data && data.ErrorMessage) ? data.ErrorMessage : "Something went wrong";
        responseDiv.textContent = getTranslatedError(msg);
        responseDiv.style.display = 'block';
      }
    } catch (err) {
      responseDiv.className = 'message error';
      responseDiv.textContent = uiTranslations[currentLang].defaultError;
      responseDiv.style.display = 'block';
    } finally {
      submitBtn.disabled = false;
      submitBtn.textContent = originalBtnText;
    }
  };

  applyLanguage();
</script>

</body>
</html>